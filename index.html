<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연립방정식 계산 연습 애플리케이션</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 500px;
        }
        h1, h2 {
            color: #333;
            text-align: center;
        }
        .input-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        #start-quiz, #submit-answer {
            display: block;
            margin: 1rem auto;
            width: 50%;
        }
        #feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            text-align: center;
        }
        .correct {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .incorrect {
            background-color: #f2dede;
            color: #a94442;
        }
        #quiz-section {
            display: none;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }
        #end-quiz {
            background-color: #e74c3c;
        }
        #end-quiz:hover {
            background-color: #c0392b;
        }
        #problem-title h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        #problem-title p {
            margin-bottom: 20px;
        }
        *::before, *::after {
            content: none !important;
        }
        body *:not(input):not(textarea) {
            user-select: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="student-info">
            <h1>수학 퀴즈</h1>
            <div class="input-group">
                <label for="student-id">학번:</label>
                <input type="text" id="student-id">
            </div>
            <div class="input-group">
                <label for="student-name">이름:</label>
                <input type="text" id="student-name">
            </div>
            <button id="start-quiz">퀴즈 시작</button>
        </div>

        <div id="quiz-section">
            <div id="problem-title"></div>
            <div class="input-group">
                <label for="x-value">x 값:</label>
                <input type="number" id="x-value">
            </div>
            <div class="input-group">
                <label for="y-value">y 값:</label>
                <input type="number" id="y-value">
            </div>
            <button id="submit-answer">정답 제출</button>
            <div id="feedback"></div>
            <div class="navigation">
                <button id="prev-problem">이전</button>
                <button id="end-quiz">종료</button>
                <button id="next-problem">다음</button>
            </div>
        </div>
    </div>

    <script src="problem.js"></script>
    <script>
        let problems = [];
        let currentProblemIndex = -1;
        let studentName = '';
        let studentId = '';
        let startTime;
        let endTime;
        let score = 0;
        let answeredQuestions = 0;

        document.addEventListener('DOMContentLoaded', function() {
            loadProblems();
            document.getElementById('start-quiz').addEventListener('click', startQuiz);
            document.getElementById('submit-answer').addEventListener('click', checkAnswer);
            document.getElementById('prev-problem').addEventListener('click', () => navigateProblem(-1));
            document.getElementById('next-problem').addEventListener('click', () => navigateProblem(1));
            document.getElementById('end-quiz').addEventListener('click', endQuiz);
        });

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function loadProblems() {
            problems = problemsData || [];
            if (problems.length > 0) {
                shuffleArray(problems);
            } else {
                console.error('문제가 로드되지 않음');
                alert('문제가 로드되지 않았습니다.');
            }
        }

        function startQuiz() {
            studentId = document.getElementById('student-id').value.trim();
            studentName = document.getElementById('student-name').value.trim();

            if (studentId && studentName) {
                if (problems.length > 0) {
                    document.getElementById('student-info').style.display = 'none';
                    document.getElementById('quiz-section').style.display = 'block';
                    currentProblemIndex = 0;
                    navigateProblem(0);
                    startTime = new Date();
                } else {
                    alert('문제가 로드되지 않았습니다.');
                }
            } else {
                alert('학번과 이름을 모두 입력해주세요.');
            }
        }

        function navigateProblem(direction) {
            currentProblemIndex += direction;
            if (currentProblemIndex < 0) currentProblemIndex = 0;
            if (currentProblemIndex >= problems.length) currentProblemIndex = problems.length - 1;
            
            showProblem();
        }

        function showProblem() {
            if (problems.length > 0 && currentProblemIndex >= 0 && currentProblemIndex < problems.length) {
                const currentProblem = problems[currentProblemIndex];
                document.getElementById('problem-title').innerHTML = `
                    <h2>문제 ${currentProblemIndex + 1}</h2>
                    <p>${currentProblem.question}</p>
                `;
                document.getElementById('x-value').value = '';
                document.getElementById('y-value').value = '';
                document.getElementById('feedback').textContent = '';
                document.getElementById('feedback').className = '';
                
                document.getElementById('prev-problem').disabled = currentProblemIndex === 0;
                document.getElementById('next-problem').disabled = currentProblemIndex === problems.length - 1;
            } else {
                document.getElementById('problem-title').textContent = '더 이상 문제가 없습니다.';
            }
        }

        function checkAnswer() {
            const currentProblem = problems[currentProblemIndex];
            const userX = parseFloat(document.getElementById('x-value').value);
            const userY = parseFloat(document.getElementById('y-value').value);
            let feedback = document.getElementById('feedback');

            if (!isNaN(userX) && !isNaN(userY)) {
                if (Math.abs(currentProblem.x - userX) < 0.01 && Math.abs(currentProblem.y - userY) < 0.01) {
                    feedback.textContent = '정답입니다!';
                    feedback.className = 'correct';
                    score += 1;
                } else {
                    feedback.textContent = '틀렸습니다. 다시 시도하세요.';
                    feedback.className = 'incorrect';
                }
                answeredQuestions += 1;
            } else {
                alert('x 값과 y 값을 모두 입력해주세요.');
            }
        }

        function endQuiz() {
            endTime = new Date();
            const timeTaken = (endTime - startTime) / 1000;
            const data = {
                studentId,
                studentName,
                timeTaken,
                score,
                answeredQuestions
            };

            sendDataToGoogleSheet(data);
        }

        async function sendDataToGoogleSheet(data) {
    try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbygTytt7tXgvFS768uKWXyR6p8V1nU7usr7aF8sqOiEYbA7kw4GCOoif4Cz_nj4tsI5tQ/exec', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                studentId: data.studentId,
                studentName: data.studentName,
                timeTaken: data.timeTaken.toFixed(2),
                score: data.score,
                answeredQuestions: data.answeredQuestions
            }),
            mode: 'cors' // Explicitly set CORS mode
        });

        const result = await response.json();
        
        if (response.ok) {
            alert('퀴즈가 종료되었습니다. 데이터를 전송했습니다.');
        } else {
            alert('데이터 전송에 실패했습니다: ' + result.error);
        }
        location.reload();
    } catch (error) {
        console.error('데이터 전송 중 오류 발생:', error);
        alert('데이터 전송에 실패했습니다.');
    }
}

    </script>
</body>
</html>


